<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="script-src file://* https://* 'unsafe-eval' 'unsafe-inline' 'self'">
    <style>
      * {
        font-family: monospace;
      }

      :root {
        background-color: black;
        color: white;
      }

      body, p, h1, h2 {
        padding: 0;
        margin: 0;
      }

      body {
        --gap-small: 1em;
        --gap-standard: 2em;
        --gap-large: 4em;
        --app-padding: var(--gap-standard);
        max-width: 100vw;
        min-height: 100vh;
        max-height: 100vh;
        overflow: hidden;
        padding: var(--app-padding);
      }

      .app {
        width: calc(100vw - 2 * var(--app-padding));
        height: calc(100vh - 2 * var(--app-padding));
        display: grid;
        grid-template-columns: 1fr 16em;
        grid-template-rows: min-content 1fr;
        gap: var(--gap-standard);
      }

      aside {
        display: flex;
        flex-direction: column;
        gap: var(--gap-standard);
      }

      select,
      button {
        padding: .6em .3em;
      }

      h2 {
        text-transform: uppercase;
        font-size: 1.2rem;
      }

      #canvas {
        grid-row: span 2;
        border: .2em dashed white;
        display: block;
        width: 100%;
        height: 100%;
        /* height: 700px; */
      }

      .stats {
        display: flex;
        flex-direction: column;
        gap: .2em;
      }

      .stats > * {
        display: flex;
        flex-direction: row;
      }

      .stats > * > :first-child {
        flex-basis: 10em;
      }

      .horizontal-equal {
        width: 100%;
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: var(--gap-small);
      }

      .small-gap {
        display: flex;
        flex-direction: column;
        gap: var(--gap-small);
      }
    </style>
  </head>
  <body>
    <div class="app">
      <canvas id="canvas"></canvas>

      <h1>
        Game of Life
      </h1>

      <aside>

        <section class="small-gap">
          <h2>Board</h2>
          <form class="small-gap">
            <select id="board_type">
              <option value="random-50">Random (50% alive)</option>
              <option value="sample-1">Sample #1</option>
              <option value="r-pentomino">R-pentomino</option>
              <option value="puffer-train-1">Puffer train #1 (Gosper, 1971)</option>
              <option value="puffer-train-2">Puffer train #2 (Schank, 2014)</option>
            </select>
            <button data-action="generate_board">Generate</button>
          </form>
        </section>

        <section class="small-gap">
          <h2>Gameplay</h2>
          <div class="horizontal-equal">
            <button data-action="start_gameplay">Start</button>
            <button data-action="stop_gameplay">Stop</button>
            <button data-action="step_gameplay">Step</button>
          </div>
        </section>

        <section class="small-gap">
          <h2>Stats</h2>
          <section class="stats">
            <p><span>Generation</span><span id="generation">&mdash;</span></p>
            <!-- <p><span>Population</span><span id="population">&mdash;</span></p> -->
            <p><span>Evolution time</span><span id="evolution-time">&mdash;</span></p>
            <p><span>Paint time</span><span id="paint-time">&mdash;</span></p>
          </section>
        </section>

      </aside>
    </div>

    <script src="js/main.js"></script>

    <script>
      let $ = document.querySelector.bind(document)
      let $$ = (x) => Array.from(document.querySelectorAll(x))

      let callback = (stats) => {
        $('#generation').textContent = stats.generation
        $('#evolution-time').textContent = `${stats.evolution_time.toFixed(0)} ms`
        $('#paint-time').textContent = `${stats.paint_time.toFixed(0)} ms`
      }

      let game = game_of_life.main.create_game($('#canvas'), callback)
      game_of_life.main.generate_board(game, 'random-50')

      $$('button').forEach((button) => {
        button.addEventListener('click', (event) => {
          event.preventDefault()
          let action = event.target.dataset.action
          console.log('action', action, $('#board_type').value)
          switch (action) {
            case 'generate_board':
              game_of_life.main[action](game, $('#board_type').value)
              break
            case 'start_gameplay':
            case 'stop_gameplay':
            case 'step_gameplay':
              game_of_life.main[action](game)
              break
            default:
              alert('Error')
              null
          }
        })
      })

    </script>
  </body>
</html>
